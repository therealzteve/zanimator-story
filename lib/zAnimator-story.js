(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.zAnimatorStory = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (options) {
  var handler = {};

  handler.handle = function (data) {
    data = (0, _optionsPreparer2.default)(data);
    data.parent.add(data.child);
  };

  return handler;
};

var _optionsPreparer = require(3);

var _optionsPreparer2 = _interopRequireDefault(_optionsPreparer);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}


},{"3":3}],2:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (options) {
  var handler = {};

  handler.handle = function (data) {
    var path = options.zAnimator;
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = data.type.split('.')[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var typePart = _step.value;

        path = path[typePart];
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    (0, _optionsPreparer2.default)(data.options);
    _idPool2.default.set(data.id, path(data.options));
  };

  return handler;
};

var _optionsPreparer = require(3);

var _optionsPreparer2 = _interopRequireDefault(_optionsPreparer);

var _idPool = require(7);

var _idPool2 = _interopRequireDefault(_idPool);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}


},{"3":3,"7":7}],3:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _idPool = require(7);

var _idPool2 = _interopRequireDefault(_idPool);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var prepareOptions = function prepareOptions(options) {

  for (var parameter in options) {
    if (typeof options[parameter] === 'string' && options[parameter].substring(0, 1) === '$') {
      options[parameter] = _idPool2.default.get(options[parameter].substring(1));
    }
  }

  return options;
};

exports.default = prepareOptions;


},{"7":7}],4:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (options) {
  var handler = {};

  handler.handle = function (data) {

    (0, _optionsPreparer2.default)(data.options);

    for (var param in data.options) {
      _idPool2.default.get(data.id)[param] = data.options[param];
    }
  };

  return handler;
};

var _optionsPreparer = require(3);

var _optionsPreparer2 = _interopRequireDefault(_optionsPreparer);

var _idPool = require(7);

var _idPool2 = _interopRequireDefault(_idPool);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}


},{"3":3,"7":7}],5:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function () {
  var handler = {};

  handler.handle = function (data) {
    _idPool2.default.get(data.id).start();
  };

  return handler;
};

var _idPool = require(7);

var _idPool2 = _interopRequireDefault(_idPool);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}


},{"7":7}],6:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function () {
  var handler = {};

  handler.handle = function (data) {
    _idPool2.default.get(data.id).stop();
  };

  return handler;
};

var _idPool = require(7);

var _idPool2 = _interopRequireDefault(_idPool);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}


},{"7":7}],7:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var idPool = function idPool() {
  var poolObject = {};
  var pool = {};

  poolObject.init = function (mainContainer) {
    pool['0'] = mainContainer;
  };

  poolObject.clean = function () {
    if (pool['0']) {
      pool['0'].removeAll();
      pool = {};
    }
  };

  poolObject.get = function (id) {
    console.log('get ' + id);
    return pool[id];
  };

  poolObject.set = function (id, value) {
    console.log('set ' + id);
    pool[id] = value;
  };

  poolObject.update = function () {
    for (var id in pool) {
      if (pool[id].draw) {
        pool[id].draw();
      }
    }
  };

  return poolObject;
};

exports.default = idPool();


},{}],8:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.create = create;

var _storyHandler = require(10);

var _storyHandler2 = _interopRequireDefault(_storyHandler);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function create(options) {
  var zAnimator = options.zAnimator;
  var sHandler = (0, _storyHandler2.default)({ zAnimator: zAnimator });
  if (options.interval) {
    sHandler.interval = options.interval;
  }

  return {
    play: function play(story) {
      sHandler.story = JSON.parse(JSON.stringify(story));
      sHandler.start();
    },
    stop: function stop() {
      sHandler.stop();
    }
  };
}


},{"10":10}],9:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (options) {
  var storyReader = {};

  storyReader.handlers = {};
  storyReader.handlers.create = (0, _createHandler2.default)({ zAnimator: options.zAnimator });
  storyReader.handlers.add = (0, _addHandler2.default)({ zAnimator: options.zAnimator });
  storyReader.handlers.prop = (0, _propHandler2.default)({});
  storyReader.handlers.start = (0, _startHandler2.default)();
  storyReader.handlers.stop = (0, _stopHandler2.default)();

  storyReader.read = function (storyPart) {
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = storyPart[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var command = _step.value;

        storyReader.handlers[command.action].handle(command.data);
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }
  };

  return storyReader;
};

var _createHandler = require(2);

var _createHandler2 = _interopRequireDefault(_createHandler);

var _addHandler = require(1);

var _addHandler2 = _interopRequireDefault(_addHandler);

var _propHandler = require(4);

var _propHandler2 = _interopRequireDefault(_propHandler);

var _startHandler = require(5);

var _startHandler2 = _interopRequireDefault(_startHandler);

var _stopHandler = require(6);

var _stopHandler2 = _interopRequireDefault(_stopHandler);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}


},{"1":1,"2":2,"4":4,"5":5,"6":6}],10:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (options) {
  var internalTimer = (0, _timer2.default)(handler);
  var storyReader = (0, _storyReader2.default)({ zAnimator: options.zAnimator });
  var storyHandler = {};
  storyHandler.timePassed = 0;
  storyHandler.interval = 100; // ~60 fps
  storyHandler.lastFrame = -1;
  storyHandler.story = false;

  storyHandler.start = function () {
    console.log('starting new story');
    _idPool2.default.init(options.zAnimator.mainContainer);
    storyHandler.timePassed = 0;
    storyHandler.lastFrame = -1;
    storyHandler.play();
  };

  storyHandler.stop = function () {
    storyHandler.pause();
    storyHandler.timePassed = 0;
    storyHandler.lastFrame = -1;
    _idPool2.default.clean();
  };

  storyHandler.play = function () {
    if (storyHandler.story) {
      if (storyHandler.story.interval) {
        storyHandler.interval = storyHandler.story.interval;
      }
      internalTimer.start();
    } else {
      console.warn('No story was set before. Aborting play.');
    }
  };

  storyHandler.pause = function () {
    internalTimer.stop();
  };

  function checkIfFinished() {
    for (var i = 0; i < storyHandler.story.timeSlots.length; i++) {
      var timeSlotIndex = Math.floor(storyHandler.timePassed / storyHandler.interval / Math.pow(2, i));
      if (timeSlotIndex < storyHandler.story.timeSlots[i].length) {
        return false;
      }
    }
    return true;
  }

  var tellStory = function tellStory() {

    // Handle each timeslots
    for (var i = 0; i < storyHandler.story.timeSlots.length; i++) {
      var timeSlotIndex = Math.floor(storyHandler.timePassed / storyHandler.interval / Math.pow(2, i));
      if (timeSlotIndex > storyHandler.lastFrame / Math.pow(2, i)) {
        if (timeSlotIndex >= storyHandler.story.timeSlots[i].length) {
          continue;
        }
        storyReader.read(storyHandler.story.timeSlots[i][timeSlotIndex]);
      }
    }
    storyHandler.lastFrame = Math.floor(storyHandler.timePassed / storyHandler.interval);
    _idPool2.default.update();
    if (checkIfFinished()) {
      storyHandler.stop();
    }
  };

  function handler(time) {
    storyHandler.timePassed += time;

    tellStory();
  }

  return storyHandler;
};

var _timer = require(11);

var _timer2 = _interopRequireDefault(_timer);

var _storyReader = require(9);

var _storyReader2 = _interopRequireDefault(_storyReader);

var _idPool = require(7);

var _idPool2 = _interopRequireDefault(_idPool);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}


},{"11":11,"7":7,"9":9}],11:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

exports.default = function (callback) {
  var timer = {};

  timer.start = function () {
    createjs.Ticker.addEventListener('tick', timer.handle);
  };

  timer.stop = function () {
    createjs.Ticker.removeEventListener('tick', timer.handle);
  };

  timer.handle = function (event) {
    callback(event.delta);
  };

  return timer;
};


},{}]},{},[8])(8)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIudG1wXFxoYW5kbGVyXFxhZGQtaGFuZGxlci5qcyIsIi50bXBcXGhhbmRsZXJcXGNyZWF0ZS1oYW5kbGVyLmpzIiwiLnRtcFxcaGFuZGxlclxcb3B0aW9ucy1wcmVwYXJlci5qcyIsIi50bXBcXGhhbmRsZXJcXHByb3AtaGFuZGxlci5qcyIsIi50bXBcXGhhbmRsZXJcXHN0YXJ0LWhhbmRsZXIuanMiLCIudG1wXFxoYW5kbGVyXFxzdG9wLWhhbmRsZXIuanMiLCIudG1wXFxpZC1wb29sLmpzIiwiLnRtcFxcbWFpbi5qcyIsIi50bXBcXHN0b3J5LXJlYWRlci5qcyIsIi50bXBcXHRpbWVyXFxzdG9yeS1oYW5kbGVyLmpzIiwiLnRtcFxcdGltZXJcXHRpbWVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7O0FBRUEsT0FBTyxjQUFQLENBQXNCLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDLFNBQU87QUFEb0MsQ0FBN0M7O0FBSUEsUUFBUSxPQUFSLEdBQWtCLFVBQVUsT0FBVixFQUFtQjtBQUNuQyxNQUFJLFVBQVUsRUFBZDs7QUFFQSxVQUFRLE1BQVIsR0FBaUIsVUFBVSxJQUFWLEVBQWdCO0FBQy9CLFdBQU8sQ0FBQyxHQUFHLGtCQUFrQixPQUF0QixFQUErQixJQUEvQixDQUFQO0FBQ0EsU0FBSyxNQUFMLENBQVksR0FBWixDQUFnQixLQUFLLEtBQXJCO0FBQ0QsR0FIRDs7QUFLQSxTQUFPLE9BQVA7QUFDRCxDQVREOztBQVdBLElBQUksbUJBQW1CLFFBQVEsb0JBQVIsQ0FBdkI7O0FBRUEsSUFBSSxvQkFBb0IsdUJBQXVCLGdCQUF2QixDQUF4Qjs7QUFFQSxTQUFTLHNCQUFULENBQWdDLEdBQWhDLEVBQXFDO0FBQUUsU0FBTyxPQUFPLElBQUksVUFBWCxHQUF3QixHQUF4QixHQUE4QixFQUFFLFNBQVMsR0FB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TUFBVCxDQUFnQixtQkFBaEIsQ0FBb0MsTUFBcEMsRUFBNEMsTUFBTSxNQUFsRDtBQUNELEdBRkQ7O0FBSUEsUUFBTSxNQUFOLEdBQWUsVUFBVSxLQUFWLEVBQWlCO0FBQzlCLGFBQVMsTUFBTSxLQUFmO0FBQ0QsR0FGRDs7QUFJQSxTQUFPLEtBQVA7QUFDRCxDQWhCRDtBQWlCQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cbmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gIHZhciBoYW5kbGVyID0ge307XG5cbiAgaGFuZGxlci5oYW5kbGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIGRhdGEgPSAoMCwgX29wdGlvbnNQcmVwYXJlcjIuZGVmYXVsdCkoZGF0YSk7XG4gICAgZGF0YS5wYXJlbnQuYWRkKGRhdGEuY2hpbGQpO1xuICB9O1xuXG4gIHJldHVybiBoYW5kbGVyO1xufTtcblxudmFyIF9vcHRpb25zUHJlcGFyZXIgPSByZXF1aXJlKCcuL29wdGlvbnMtcHJlcGFyZXInKTtcblxudmFyIF9vcHRpb25zUHJlcGFyZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfb3B0aW9uc1ByZXBhcmVyKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFkZC1oYW5kbGVyLmpzLm1hcFxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuXG5leHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICB2YXIgaGFuZGxlciA9IHt9O1xuXG4gIGhhbmRsZXIuaGFuZGxlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICB2YXIgcGF0aCA9IG9wdGlvbnMuekFuaW1hdG9yO1xuICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTtcbiAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTtcbiAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7XG5cbiAgICB0cnkge1xuICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gZGF0YS50eXBlLnNwbGl0KCcuJylbU3ltYm9sLml0ZXJhdG9yXSgpLCBfc3RlcDsgIShfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gKF9zdGVwID0gX2l0ZXJhdG9yLm5leHQoKSkuZG9uZSk7IF9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gPSB0cnVlKSB7XG4gICAgICAgIHZhciB0eXBlUGFydCA9IF9zdGVwLnZhbHVlO1xuXG4gICAgICAgIHBhdGggPSBwYXRoW3R5cGVQYXJ0XTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTtcbiAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybikge1xuICAgICAgICAgIF9pdGVyYXRvci5yZXR1cm4oKTtcbiAgICAgICAgfVxuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAoMCwgX29wdGlvbnNQcmVwYXJlcjIuZGVmYXVsdCkoZGF0YS5vcHRpb25zKTtcbiAgICBfaWRQb29sMi5kZWZhdWx0LnNldChkYXRhLmlkLCBwYXRoKGRhdGEub3B0aW9ucykpO1xuICB9O1xuXG4gIHJldHVybiBoYW5kbGVyO1xufTtcblxudmFyIF9vcHRpb25zUHJlcGFyZXIgPSByZXF1aXJlKCcuL29wdGlvbnMtcHJlcGFyZXInKTtcblxudmFyIF9vcHRpb25zUHJlcGFyZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfb3B0aW9uc1ByZXBhcmVyKTtcblxudmFyIF9pZFBvb2wgPSByZXF1aXJlKCcuLi9pZC1wb29sJyk7XG5cbnZhciBfaWRQb29sMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lkUG9vbCk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG4vLyMgc291cmNlTWFwcGluZ1VSTD1jcmVhdGUtaGFuZGxlci5qcy5tYXBcbiIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcblxudmFyIF9pZFBvb2wgPSByZXF1aXJlKCcuLi9pZC1wb29sJyk7XG5cbnZhciBfaWRQb29sMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lkUG9vbCk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbnZhciBwcmVwYXJlT3B0aW9ucyA9IGZ1bmN0aW9uIHByZXBhcmVPcHRpb25zKG9wdGlvbnMpIHtcblxuICBmb3IgKHZhciBwYXJhbWV0ZXIgaW4gb3B0aW9ucykge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9uc1twYXJhbWV0ZXJdID09PSAnc3RyaW5nJyAmJiBvcHRpb25zW3BhcmFtZXRlcl0uc3Vic3RyaW5nKDAsIDEpID09PSAnJCcpIHtcbiAgICAgIG9wdGlvbnNbcGFyYW1ldGVyXSA9IF9pZFBvb2wyLmRlZmF1bHQuZ2V0KG9wdGlvbnNbcGFyYW1ldGVyXS5zdWJzdHJpbmcoMSkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvcHRpb25zO1xufTtcblxuZXhwb3J0cy5kZWZhdWx0ID0gcHJlcGFyZU9wdGlvbnM7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1vcHRpb25zLXByZXBhcmVyLmpzLm1hcFxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuXG5leHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICB2YXIgaGFuZGxlciA9IHt9O1xuXG4gIGhhbmRsZXIuaGFuZGxlID0gZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgICgwLCBfb3B0aW9uc1ByZXBhcmVyMi5kZWZhdWx0KShkYXRhLm9wdGlvbnMpO1xuXG4gICAgZm9yICh2YXIgcGFyYW0gaW4gZGF0YS5vcHRpb25zKSB7XG4gICAgICBfaWRQb29sMi5kZWZhdWx0LmdldChkYXRhLmlkKVtwYXJhbV0gPSBkYXRhLm9wdGlvbnNbcGFyYW1dO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gaGFuZGxlcjtcbn07XG5cbnZhciBfb3B0aW9uc1ByZXBhcmVyID0gcmVxdWlyZSgnLi9vcHRpb25zLXByZXBhcmVyJyk7XG5cbnZhciBfb3B0aW9uc1ByZXBhcmVyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX29wdGlvbnNQcmVwYXJlcik7XG5cbnZhciBfaWRQb29sID0gcmVxdWlyZSgnLi4vaWQtcG9vbCcpO1xuXG52YXIgX2lkUG9vbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pZFBvb2wpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cHJvcC1oYW5kbGVyLmpzLm1hcFxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuXG5leHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBoYW5kbGVyID0ge307XG5cbiAgaGFuZGxlci5oYW5kbGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIF9pZFBvb2wyLmRlZmF1bHQuZ2V0KGRhdGEuaWQpLnN0YXJ0KCk7XG4gIH07XG5cbiAgcmV0dXJuIGhhbmRsZXI7XG59O1xuXG52YXIgX2lkUG9vbCA9IHJlcXVpcmUoJy4uL2lkLXBvb2wnKTtcblxudmFyIF9pZFBvb2wyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaWRQb29sKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXN0YXJ0LWhhbmRsZXIuanMubWFwXG4iLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cbmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGhhbmRsZXIgPSB7fTtcblxuICBoYW5kbGVyLmhhbmRsZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgX2lkUG9vbDIuZGVmYXVsdC5nZXQoZGF0YS5pZCkuc3RvcCgpO1xuICB9O1xuXG4gIHJldHVybiBoYW5kbGVyO1xufTtcblxudmFyIF9pZFBvb2wgPSByZXF1aXJlKCcuLi9pZC1wb29sJyk7XG5cbnZhciBfaWRQb29sMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2lkUG9vbCk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdG9wLWhhbmRsZXIuanMubWFwXG4iLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG52YXIgaWRQb29sID0gZnVuY3Rpb24gaWRQb29sKCkge1xuICB2YXIgcG9vbE9iamVjdCA9IHt9O1xuICB2YXIgcG9vbCA9IHt9O1xuXG4gIHBvb2xPYmplY3QuaW5pdCA9IGZ1bmN0aW9uIChtYWluQ29udGFpbmVyKSB7XG4gICAgcG9vbFsnMCddID0gbWFpbkNvbnRhaW5lcjtcbiAgfTtcblxuICBwb29sT2JqZWN0LmNsZWFuID0gZnVuY3Rpb24gKCkge1xuICAgIGlmIChwb29sWycwJ10pIHtcbiAgICAgIHBvb2xbJzAnXS5yZW1vdmVBbGwoKTtcbiAgICAgIHBvb2wgPSB7fTtcbiAgICB9XG4gIH07XG5cbiAgcG9vbE9iamVjdC5nZXQgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICBjb25zb2xlLmxvZygnZ2V0ICcgKyBpZCk7XG4gICAgcmV0dXJuIHBvb2xbaWRdO1xuICB9O1xuXG4gIHBvb2xPYmplY3Quc2V0ID0gZnVuY3Rpb24gKGlkLCB2YWx1ZSkge1xuICAgIGNvbnNvbGUubG9nKCdzZXQgJyArIGlkKTtcbiAgICBwb29sW2lkXSA9IHZhbHVlO1xuICB9O1xuXG4gIHBvb2xPYmplY3QudXBkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIGlkIGluIHBvb2wpIHtcbiAgICAgIGlmIChwb29sW2lkXS5kcmF3KSB7XG4gICAgICAgIHBvb2xbaWRdLmRyYXcoKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHBvb2xPYmplY3Q7XG59O1xuXG5leHBvcnRzLmRlZmF1bHQgPSBpZFBvb2woKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWlkLXBvb2wuanMubWFwXG4iLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmNyZWF0ZSA9IGNyZWF0ZTtcblxudmFyIF9zdG9yeUhhbmRsZXIgPSByZXF1aXJlKCcuL3RpbWVyL3N0b3J5LWhhbmRsZXInKTtcblxudmFyIF9zdG9yeUhhbmRsZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3RvcnlIYW5kbGVyKTtcblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZnVuY3Rpb24gY3JlYXRlKG9wdGlvbnMpIHtcbiAgdmFyIHpBbmltYXRvciA9IG9wdGlvbnMuekFuaW1hdG9yO1xuICB2YXIgc0hhbmRsZXIgPSAoMCwgX3N0b3J5SGFuZGxlcjIuZGVmYXVsdCkoeyB6QW5pbWF0b3I6IHpBbmltYXRvciB9KTtcbiAgaWYgKG9wdGlvbnMuaW50ZXJ2YWwpIHtcbiAgICBzSGFuZGxlci5pbnRlcnZhbCA9IG9wdGlvbnMuaW50ZXJ2YWw7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHBsYXk6IGZ1bmN0aW9uIHBsYXkoc3RvcnkpIHtcbiAgICAgIHNIYW5kbGVyLnN0b3J5ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShzdG9yeSkpO1xuICAgICAgc0hhbmRsZXIuc3RhcnQoKTtcbiAgICB9LFxuICAgIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgICBzSGFuZGxlci5zdG9wKCk7XG4gICAgfVxuICB9O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9bWFpbi5qcy5tYXBcbiIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcblxuZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgdmFyIHN0b3J5UmVhZGVyID0ge307XG5cbiAgc3RvcnlSZWFkZXIuaGFuZGxlcnMgPSB7fTtcbiAgc3RvcnlSZWFkZXIuaGFuZGxlcnMuY3JlYXRlID0gKDAsIF9jcmVhdGVIYW5kbGVyMi5kZWZhdWx0KSh7IHpBbmltYXRvcjogb3B0aW9ucy56QW5pbWF0b3IgfSk7XG4gIHN0b3J5UmVhZGVyLmhhbmRsZXJzLmFkZCA9ICgwLCBfYWRkSGFuZGxlcjIuZGVmYXVsdCkoeyB6QW5pbWF0b3I6IG9wdGlvbnMuekFuaW1hdG9yIH0pO1xuICBzdG9yeVJlYWRlci5oYW5kbGVycy5wcm9wID0gKDAsIF9wcm9wSGFuZGxlcjIuZGVmYXVsdCkoe30pO1xuICBzdG9yeVJlYWRlci5oYW5kbGVycy5zdGFydCA9ICgwLCBfc3RhcnRIYW5kbGVyMi5kZWZhdWx0KSgpO1xuICBzdG9yeVJlYWRlci5oYW5kbGVycy5zdG9wID0gKDAsIF9zdG9wSGFuZGxlcjIuZGVmYXVsdCkoKTtcblxuICBzdG9yeVJlYWRlci5yZWFkID0gZnVuY3Rpb24gKHN0b3J5UGFydCkge1xuICAgIHZhciBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZTtcbiAgICB2YXIgX2RpZEl0ZXJhdG9yRXJyb3IgPSBmYWxzZTtcbiAgICB2YXIgX2l0ZXJhdG9yRXJyb3IgPSB1bmRlZmluZWQ7XG5cbiAgICB0cnkge1xuICAgICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gc3RvcnlQYXJ0W1N5bWJvbC5pdGVyYXRvcl0oKSwgX3N0ZXA7ICEoX2l0ZXJhdG9yTm9ybWFsQ29tcGxldGlvbiA9IChfc3RlcCA9IF9pdGVyYXRvci5uZXh0KCkpLmRvbmUpOyBfaXRlcmF0b3JOb3JtYWxDb21wbGV0aW9uID0gdHJ1ZSkge1xuICAgICAgICB2YXIgY29tbWFuZCA9IF9zdGVwLnZhbHVlO1xuXG4gICAgICAgIHN0b3J5UmVhZGVyLmhhbmRsZXJzW2NvbW1hbmQuYWN0aW9uXS5oYW5kbGUoY29tbWFuZC5kYXRhKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIF9kaWRJdGVyYXRvckVycm9yID0gdHJ1ZTtcbiAgICAgIF9pdGVyYXRvckVycm9yID0gZXJyO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoIV9pdGVyYXRvck5vcm1hbENvbXBsZXRpb24gJiYgX2l0ZXJhdG9yLnJldHVybikge1xuICAgICAgICAgIF9pdGVyYXRvci5yZXR1cm4oKTtcbiAgICAgICAgfVxuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaWYgKF9kaWRJdGVyYXRvckVycm9yKSB7XG4gICAgICAgICAgdGhyb3cgX2l0ZXJhdG9yRXJyb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHN0b3J5UmVhZGVyO1xufTtcblxudmFyIF9jcmVhdGVIYW5kbGVyID0gcmVxdWlyZSgnLi9oYW5kbGVyL2NyZWF0ZS1oYW5kbGVyJyk7XG5cbnZhciBfY3JlYXRlSGFuZGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9jcmVhdGVIYW5kbGVyKTtcblxudmFyIF9hZGRIYW5kbGVyID0gcmVxdWlyZSgnLi9oYW5kbGVyL2FkZC1oYW5kbGVyJyk7XG5cbnZhciBfYWRkSGFuZGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9hZGRIYW5kbGVyKTtcblxudmFyIF9wcm9wSGFuZGxlciA9IHJlcXVpcmUoJy4vaGFuZGxlci9wcm9wLWhhbmRsZXInKTtcblxudmFyIF9wcm9wSGFuZGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9wcm9wSGFuZGxlcik7XG5cbnZhciBfc3RhcnRIYW5kbGVyID0gcmVxdWlyZSgnLi9oYW5kbGVyL3N0YXJ0LWhhbmRsZXInKTtcblxudmFyIF9zdGFydEhhbmRsZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfc3RhcnRIYW5kbGVyKTtcblxudmFyIF9zdG9wSGFuZGxlciA9IHJlcXVpcmUoJy4vaGFuZGxlci9zdG9wLWhhbmRsZXInKTtcblxudmFyIF9zdG9wSGFuZGxlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zdG9wSGFuZGxlcik7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG4vLyMgc291cmNlTWFwcGluZ1VSTD1zdG9yeS1yZWFkZXIuanMubWFwXG4iLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cbmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gIHZhciBpbnRlcm5hbFRpbWVyID0gKDAsIF90aW1lcjIuZGVmYXVsdCkoaGFuZGxlcik7XG4gIHZhciBzdG9yeVJlYWRlciA9ICgwLCBfc3RvcnlSZWFkZXIyLmRlZmF1bHQpKHsgekFuaW1hdG9yOiBvcHRpb25zLnpBbmltYXRvciB9KTtcbiAgdmFyIHN0b3J5SGFuZGxlciA9IHt9O1xuICBzdG9yeUhhbmRsZXIudGltZVBhc3NlZCA9IDA7XG4gIHN0b3J5SGFuZGxlci5pbnRlcnZhbCA9IDEwMDsgLy8gfjYwIGZwc1xuICBzdG9yeUhhbmRsZXIubGFzdEZyYW1lID0gLTE7XG4gIHN0b3J5SGFuZGxlci5zdG9yeSA9IGZhbHNlO1xuXG4gIHN0b3J5SGFuZGxlci5zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZygnc3RhcnRpbmcgbmV3IHN0b3J5Jyk7XG4gICAgX2lkUG9vbDIuZGVmYXVsdC5pbml0KG9wdGlvbnMuekFuaW1hdG9yLm1haW5Db250YWluZXIpO1xuICAgIHN0b3J5SGFuZGxlci50aW1lUGFzc2VkID0gMDtcbiAgICBzdG9yeUhhbmRsZXIubGFzdEZyYW1lID0gLTE7XG4gICAgc3RvcnlIYW5kbGVyLnBsYXkoKTtcbiAgfTtcblxuICBzdG9yeUhhbmRsZXIuc3RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICBzdG9yeUhhbmRsZXIucGF1c2UoKTtcbiAgICBzdG9yeUhhbmRsZXIudGltZVBhc3NlZCA9IDA7XG4gICAgc3RvcnlIYW5kbGVyLmxhc3RGcmFtZSA9IC0xO1xuICAgIF9pZFBvb2wyLmRlZmF1bHQuY2xlYW4oKTtcbiAgfTtcblxuICBzdG9yeUhhbmRsZXIucGxheSA9IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoc3RvcnlIYW5kbGVyLnN0b3J5KSB7XG4gICAgICBpZiAoc3RvcnlIYW5kbGVyLnN0b3J5LmludGVydmFsKSB7XG4gICAgICAgIHN0b3J5SGFuZGxlci5pbnRlcnZhbCA9IHN0b3J5SGFuZGxlci5zdG9yeS5pbnRlcnZhbDtcbiAgICAgIH1cbiAgICAgIGludGVybmFsVGltZXIuc3RhcnQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS53YXJuKCdObyBzdG9yeSB3YXMgc2V0IGJlZm9yZS4gQWJvcnRpbmcgcGxheS4nKTtcbiAgICB9XG4gIH07XG5cbiAgc3RvcnlIYW5kbGVyLnBhdXNlID0gZnVuY3Rpb24gKCkge1xuICAgIGludGVybmFsVGltZXIuc3RvcCgpO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGNoZWNrSWZGaW5pc2hlZCgpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0b3J5SGFuZGxlci5zdG9yeS50aW1lU2xvdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB0aW1lU2xvdEluZGV4ID0gTWF0aC5mbG9vcihzdG9yeUhhbmRsZXIudGltZVBhc3NlZCAvIHN0b3J5SGFuZGxlci5pbnRlcnZhbCAvIE1hdGgucG93KDIsIGkpKTtcbiAgICAgIGlmICh0aW1lU2xvdEluZGV4IDwgc3RvcnlIYW5kbGVyLnN0b3J5LnRpbWVTbG90c1tpXS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHZhciB0ZWxsU3RvcnkgPSBmdW5jdGlvbiB0ZWxsU3RvcnkoKSB7XG5cbiAgICAvLyBIYW5kbGUgZWFjaCB0aW1lc2xvdHNcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0b3J5SGFuZGxlci5zdG9yeS50aW1lU2xvdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB0aW1lU2xvdEluZGV4ID0gTWF0aC5mbG9vcihzdG9yeUhhbmRsZXIudGltZVBhc3NlZCAvIHN0b3J5SGFuZGxlci5pbnRlcnZhbCAvIE1hdGgucG93KDIsIGkpKTtcbiAgICAgIGlmICh0aW1lU2xvdEluZGV4ID4gc3RvcnlIYW5kbGVyLmxhc3RGcmFtZSAvIE1hdGgucG93KDIsIGkpKSB7XG4gICAgICAgIGlmICh0aW1lU2xvdEluZGV4ID49IHN0b3J5SGFuZGxlci5zdG9yeS50aW1lU2xvdHNbaV0ubGVuZ3RoKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgc3RvcnlSZWFkZXIucmVhZChzdG9yeUhhbmRsZXIuc3RvcnkudGltZVNsb3RzW2ldW3RpbWVTbG90SW5kZXhdKTtcbiAgICAgIH1cbiAgICB9XG4gICAgc3RvcnlIYW5kbGVyLmxhc3RGcmFtZSA9IE1hdGguZmxvb3Ioc3RvcnlIYW5kbGVyLnRpbWVQYXNzZWQgLyBzdG9yeUhhbmRsZXIuaW50ZXJ2YWwpO1xuICAgIF9pZFBvb2wyLmRlZmF1bHQudXBkYXRlKCk7XG4gICAgaWYgKGNoZWNrSWZGaW5pc2hlZCgpKSB7XG4gICAgICBzdG9yeUhhbmRsZXIuc3RvcCgpO1xuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiBoYW5kbGVyKHRpbWUpIHtcbiAgICBzdG9yeUhhbmRsZXIudGltZVBhc3NlZCArPSB0aW1lO1xuXG4gICAgdGVsbFN0b3J5KCk7XG4gIH1cblxuICByZXR1cm4gc3RvcnlIYW5kbGVyO1xufTtcblxudmFyIF90aW1lciA9IHJlcXVpcmUoJy4vdGltZXInKTtcblxudmFyIF90aW1lcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF90aW1lcik7XG5cbnZhciBfc3RvcnlSZWFkZXIgPSByZXF1aXJlKCcuLi9zdG9yeS1yZWFkZXInKTtcblxudmFyIF9zdG9yeVJlYWRlcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zdG9yeVJlYWRlcik7XG5cbnZhciBfaWRQb29sID0gcmVxdWlyZSgnLi4vaWQtcG9vbCcpO1xuXG52YXIgX2lkUG9vbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pZFBvb2wpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RvcnktaGFuZGxlci5qcy5tYXBcbiIsIid1c2Ugc3RyaWN0JztcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcblxuZXhwb3J0cy5kZWZhdWx0ID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gIHZhciB0aW1lciA9IHt9O1xuXG4gIHRpbWVyLnN0YXJ0ID0gZnVuY3Rpb24gKCkge1xuICAgIGNyZWF0ZWpzLlRpY2tlci5hZGRFdmVudExpc3RlbmVyKCd0aWNrJywgdGltZXIuaGFuZGxlKTtcbiAgfTtcblxuICB0aW1lci5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgIGNyZWF0ZWpzLlRpY2tlci5yZW1vdmVFdmVudExpc3RlbmVyKCd0aWNrJywgdGltZXIuaGFuZGxlKTtcbiAgfTtcblxuICB0aW1lci5oYW5kbGUgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICBjYWxsYmFjayhldmVudC5kZWx0YSk7XG4gIH07XG5cbiAgcmV0dXJuIHRpbWVyO1xufTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXRpbWVyLmpzLm1hcFxuIl19
